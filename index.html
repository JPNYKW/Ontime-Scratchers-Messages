<html>
	<head>
		<title>OSM v2.5.3 by YKW</title>
		<link rel="shortcut icon" href="code040fixfix.png">
	<script>
		var display,mov,first,old,yet,uicon;

		var str='Setting...';
		var plus=new Audio();
		var minus=new Audio();
		var prime=new Audio();
		plus.src='plus.mp3';
		minus.src='minus.mp3';
		prime.src='nc156168.mp3';
		var flag=false;
		isPrime=num=>{i=0;if(num%2==1&&num>1){for(i=2;num%i!=0;i++){console.log(0)}}return (i==num||num==2)&&num!=0};
		
		function init(){
			display=document.getElementById('display');
			mov=document.getElementById('mov');
		}

		function start(){
			uicon=document.getElementById('usericon');
			user=document.getElementById('txt').value;
			if(user!=null&&user!='')uicon.src=getIcon(user);
			mov.innerText='';
			str='Getting...';
			yet=true;
			old=null;
			flag=true;
		}
		
		icon=ID=>{return `https://cdn2.scratch.mit.edu/get_image/user/${ID}_128x128.png`};
		function getIcon(user){
			rq=new XMLHttpRequest();
			rq.open('GET',`https://api.scratch.mit.edu/users/${user}`,false);
			rq.send(null);
			if(rq.readyState==4&&rq.status==200){return icon(rq.responseText.split(/\D+/g)[1]);}}
		
		setInterval(function(){
			if(flag){
				set=user=>`https://api.scratch.mit.edu/users/${user}/messages/count`;
				rq=new XMLHttpRequest();
				rq.open('GET',set(user),false);rq.send(null);
				if(rq.readyState==4&&rq.status==200){
					r='';
					(rq.responseText).match(/[0-9]/g).forEach(function(e){r+=e});
					console.log(`${user}\'s messages:${r}`);
					if(isPrime(r)&&yet){prime.play();yet=false;}
					if(old!=r){if(old!=null){old<r?plus.play():minus.play();}old=r;yet=true;}
					display.innerText=`${user}\'s messages:${r}`;
				}
			}
			mov.innerText=str.substr(0,mov.innerText.length%(str.length)+1);
		},500);
</script>
	<style>
		body{
		color:#fafafa;
		background: linear-gradient(-90deg, #FFC342, #FFCD41, #FFEF41);
		}
		a:link{color: #3FFAFF;}
		a:visited{color:#3188C6;}
		a:hover{color:#FFF054;}
		a:active{color:#FF8223;}
	</style>
</head>

<body onload="init()">
	<center>
		<h1>Ontime Scratchers Messages - OSM v2.5.3</h1>
		UserName:<input type="text" id="txt" value="">
		<input type="button" value="done" onclick="start();"><br><br>
		<img src='noImage.png' id='usericon' width="128px" height="128px"></img><br>
		<h1 id='display'>NONAME's messages:0</h1>
		<h1 id="mov">-</h1><br>
		<img src="code040fixfix.png" onclick="window.open('https://scratch.mit.edu/users/youkaiwatch')"></img><br>
		&spades; It works by <a href="https://scratch.mit.edu/users/youkaiwatch" target="_blank">YKW</a>
	</center>
</body>
</html>
